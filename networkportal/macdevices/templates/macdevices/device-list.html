{% extends 'macdevices/base.html' %}

{% block content %}
<h2>List Of Devices from Database</h2>
<table class="table">
  <thead>
    <tr>
      <th>Device Name</th>
      <th>MAC Address</th>
      <th>Created at</th>
    </tr>
  </thead>
  <tbody>
    {% for device in devices %}
    <tr>
      <td>{{ device.name }}</td>
      <td>{{ device.mac_address }}</td>
      <td>{{ device.created_at }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<div>
  <a href="{% url 'add_device' %}" class="btn btn-primary">Add Device</a>
</div>

<!-- <h2>List Of Devices from Database</h2>

<div id="api-key-form">
  <label for="api-key-input">API Key:</label>
  <input type="text" id="api-key-input">
  <button id="api-key-submit">Submit</button>
</div>

<div id="messages"></div>

<table id="devices-table" class="table">
  <thead>
    <tr>
      <th>Device Name</th>
      <th>MAC Address</th>
      <th>Created at</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>


<script>
  $(document).ready(function() {
    var devicesTable = $('#devices-table');
    var messagesDiv = $('#messages');

    // function to load devices into the table
    function loadDevices(apiKey) {
      $.ajax({
        url: '/devicelist/',
        type: 'GET',
        beforeSend: function(xhr) {
          xhr.setRequestHeader('Authorization', 'ApiKey ' + apiKey);
        },
        success: function(response) {
          // clear the table
          devicesTable.find('tbody').empty();

          // populate the table with devices data
          for (var i = 0; i < response.length; i++) {
            var device = response[i];
            devicesTable.find('tbody').append('<tr><td>' + device.name + '</td><td>' + device.mac_address + '</td><td>' + device.created_at + '</td></tr>');
          }
        },
        error: function(response) {
          messagesDiv.html('<div class="alert alert-danger">' + response.responseJSON.detail + '</div>');
        }
      });
    }

    // handle form submission for API key authorization
    $('#api-key-form').submit(function(event) {
      event.preventDefault();

      var apiKey = $('#api-key-input').val();

      loadDevices(apiKey);
    });
  });
</script> -->

{% endblock %}
